<!--quiz.html-->
<!DOCTYPE html>
<html>
<head>
    <title>Quiz</title>
    <script>
        // This will be filled by Jinja as JSON
const commandsInfo = {{ commands_dict_json | safe }};
        const categoryCommands = {{ category_commands_json | safe }};

function updateArgsForm() {
            const command = document.getElementById("selectcommand").value;
            const argsDiv = document.getElementById("argsForm");
            argsDiv.innerHTML = ""; // clear old fields

            if (command === "random") return;

            const cmdInfo = commandsInfo[command];
            if (!cmdInfo || !cmdInfo.args) return;

            for (const [argName, argMeta] of Object.entries(cmdInfo.args)) {
                const label = document.createElement("label");
                label.textContent = argName + ": ";
                label.setAttribute("for", argName);

                let input;
                switch (argMeta.type) {
                    case "string":
                        input = document.createElement("input");
                        input.type = "text";
                        input.value = argMeta.default || "";
                        break;
                    case "integer":
                        input = document.createElement("input");
                        input.type = "number";
                        input.value = argMeta.default || 0;
                        if (argMeta.range) {
                            input.min = argMeta.range[0];
                            input.max = argMeta.range[1];
                        }
                        break;
                    case "boolean":
                        input = document.createElement("input");
                        input.type = "checkbox";
                        input.checked = argMeta.default || false;
                        break;
                    case "list":
                        input = document.createElement("textarea");
                        input.rows = 2;
                        input.placeholder = JSON.stringify(argMeta.default || []);
                        break;
                    case "dict":
                        input = document.createElement("textarea");
                        input.rows = 3;
                        input.placeholder = JSON.stringify(argMeta.default || {});
                        break;
                    default:
                        input = document.createElement("input");
                        input.type = "text";
                        input.value = argMeta.default || "";
                }

                input.name = "args[" + argName + "]";

                // Handle choices (drop-down)
                if (argMeta.choices) {
                    const select = document.createElement("select");
                    select.name = "args[" + argName + "]";
                    argMeta.choices.forEach(choice => {
                        const opt = document.createElement("option");
                        opt.value = choice;
                        opt.text = choice;
                        if (choice === argMeta.default) opt.selected = true;
                        select.appendChild(opt);
                    });
                    input = select;
                }

                const div = document.createElement("div");
                div.appendChild(label);
                div.appendChild(input);
                argsDiv.appendChild(div);
            }
        }

        function updateCommands() {
            const category = document.getElementById("selectcategory").value;
            const commandSelect = document.getElementById("selectcommand");

            // Clear existing options
            commandSelect.innerHTML = "";

            // Add default "random" option
            const optRandom = document.createElement("option");
            optRandom.value = "random";
            optRandom.text = "Random Question";
            commandSelect.appendChild(optRandom);

            // Get commands for the chosen category
            let cmds = [];
            if (category === "random") {
                // merge all commands from all categories
                for (const c in categoryCommands) {
                    cmds = cmds.concat(categoryCommands[c]);
                }
            } else {
                cmds = categoryCommands[category] || [];
            }

            // Add options
            cmds.forEach(cmd => {
                const opt = document.createElement("option");
                opt.value = cmd.name;
                opt.text = cmd.short;
                commandSelect.appendChild(opt);
            });
        }

        // Initialize on load
        window.onload = function() {
            updateCommands();
            document.getElementById("selectcommand").addEventListener("change", updateArgsForm);
        };
    </script>
</head>
<body>
    <h2>Select Command to generate a Quiz</h2>
    <form method="post" action="/submit">
        <select id="selectcategory" name="category" onchange="updateCommands()">
            <option value="random" selected> Random Category</option>
            {% for cat_key, cat_value in categories_dict.items() %}
                <option value="{{cat_key}}">{{cat_value.short}}</option>
            {% endfor %}
        </select>

        <select id="selectcommand" name="command">
            <option value="random" selected>Random Question</option>
            <!-- will be updated dynamically -->
        </select>
 <div id="argsForm"></div>
        <button type="submit">Submit</button>
    </form>
</body>
</html>

