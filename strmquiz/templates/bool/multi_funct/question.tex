{%set debug = False %}
{% if "fr" in languages %}
Etudier le circuit suivant:
{% endif %}


Study the following circuit:

\begin{arab}[utf]
ادرس الدارة الآتية:
\end{arab}

 {% for data in data_list %}

${{ data.function_name }} = {{ data.minterms }}$

{% endfor %}

\textbf{Don't Care }
 {% for data in data_list %}
${{ data.function_name }} = {{ data.dontcares }}$
{% endfor %}


$F(A,B,C,D) ={{  sop_quest|normalize_formula }}$

{% if RENDER_MODE == "question" %}

 {% endif %}

{% if RENDER_MODE == "answer" %}



\textbf{Inputs and Outputs \aRL{المداخل والمخارج}}

\begin{itemize}
\item Inputs

    \begin{itemize}
    {% for var in variables %}
        \item ${{ var }} = 0 /1 $
    {% endfor %}
    \end{itemize}
\item Outputs
    \begin{itemize}
    {% for funct_name in function_name_list %}
        \item ${{ funct_name }} = 0 /1 $
    {% endfor %}
    \end{itemize}
\end{itemize}

\textbf{Truth Table \aRL{جدول الحقيقة}}

\begin{tabular}{|c|c|c|c||{% for _ in function_name_list %}c{% if not loop.last %}|{% endif %}{% endfor %}|}
\hline
{{ variables[0] }} & {{ variables[1] }} & {{ variables[2] }} & {{ variables[3] }}
{% for funct_name in function_name_list %}
  & {{ funct_name }}
{% endfor %} \\
\hline
{% for i in range(16) %}
  {% set bits = '{:04b}'.format(i) %}
  {% set bit_list = bits | list %}
  {{ bit_list[0] }} & {{ bit_list[1] }} & {{ bit_list[2] }} & {{ bit_list[3] }}
  {% for idx in range(data_list | length) %}
    {% set minterms = minterms_list[idx] %}
    {% set dontcares = dontcares_list[idx] %}
    & {{ '1' if i in minterms else 'x' if i in dontcares else '0' }}
  {% endfor %} \\
  {% if (i + 1) % 4 == 0 %}\hline{% endif %}
{% endfor %}
\end{tabular}



\textbf{Canonical Forms \aRL{الأشكال القانونية}}
\begin{itemize}
\item \textbf{First Canonical Forms \aRL{ الأشكال القانونية الأولى}}
    \begin{itemize}
    {% for data in data_list %}
        \item ${{ data.function_name }}({{variables|join(", ")}}) =  {{  data.dnf_dict.default|normalize_formula }}$
    {% endfor %}
    \end{itemize}

\item \textbf{Second Canonical Forms \aRL{ الأشكال القانونية الثانية}}
    \begin{itemize}
    {% for data in data_list %}
        \item ${{ data.function_name }}({{variables|join(", ")}}) =  {{  data.cnf_dict.default|normalize_formula }}$
    {% endfor %}
    \end{itemize}

\item \textbf{First Canonical Forms \aRL{ الأشكال القانونية الأولى}}
    \begin{itemize}
    {% for data in data_list %}
        \item ${{ data.function_name }}({{variables|join(", ")}}) = \sum({{  data.minterms| join(", ") }})$
    {% endfor %}
    \end{itemize}

\item \textbf{Second Canonical Forms \aRL{ الأشكال القانونية الثانية}}
    \begin{itemize}
    {% for data in data_list %}
        \item ${{ data.function_name }}({{variables|join(", ")}}) =  \prod({{  data.maxterms| join(", ") }})$
    {% endfor %}
    \end{itemize}

\end{itemize}




 {% if debug or method.lower() == "nand" %}
 \textbf{ NAND forms  \aRL{بوابات نفي الوصل}}
 \begin{enumerate}
 {% for data in data_list %}

    \item ${{ data.function_name }}$ = ${{ data.nand_sop_dict.default|normalize_formula }}$

    Explanation
    \begin{itemize}
        \item ${{ data.function_name }}$ = ${{ data.sop_dict.default|normalize_formula }}$

        {% for explain in data.nand_sop_dict.explained %}
            \item  ${{ data.function_name }}$ = ${{ explain }}$
        {% endfor %}
    \end{itemize}
 {% endfor %}
 \end{enumerate}
{% endif %}

{% if method.lower() == "nor" %}
 \textbf{ NOR forms  \aRL{بوابات نفي الفصل}}
 \begin{enumerate}
 {% for data in data_list %}

    \item ${{ data.function_name }}$ = ${{ data.nor_pos_dict.default|normalize_formula }}$

    Explanation
    \begin{itemize}
        \item ${{ data.function_name }}$ = ${{ data.pos_dict.default|normalize_formula }}$

        {% for explain in data.nor_pos_dict.explained %}
            \item  ${{ data.function_name }}$ = ${{ explain }}$
        {% endfor %}
    \end{itemize}
 {% endfor %}
 \end{enumerate}
{% endif %}


\textbf{Karnaugh Table \aRL{جدول كارنوف}}

{% for data in data_list %}
\begin{karnaugh-map}[4][4][1][{{ data.cd }}][{{ data.ab }}]
  \minterms{ {{ data.minterms | join(", ") }} }
  \maxterms{ {{ data.maxterms | join(", ") }} }
  {% if dontcares %}
    \terms{ {{ data.dontcares | join(", ") }} }{X}
  {% endif %}
 {% if RENDER_MODE == "answer" %}
       {{ data.simplification |format_map_terms(method=data.method.lower())|join("\n") }}
 {% endif %}
 \end{karnaugh-map}

{% if RENDER_MODE == "answer" %}
    Simplified Sum of products : ${{ data.function_name }} = {{ data.sop_dict.default|normalize_formula }}$\\
    Simplified product of sums : ${{ data.function_name }} = {{ data.pos_dict.default|normalize_formula }}$\\

{% endif %}
{% endfor %}


\textbf{Ligc diagram \aRL{المخطط المنطقي}}

{{ logicdiagram }}

{#% include "bool/logigram/multi_logigram.tex.j2" %#}

{% include "bool/logigram/structured_logigram.tex.j2" %}
{% endif %}

{% if RENDER_MODE == "answer" %}
    {% if debug %}
        DATA list
        \begin{verbatim}
        {{data_list|pprint}}
        \end{verbatim}
    {% endif %}
{% endif %}