{% set debug = True %}
{% import "sequential/macros/flipmacros.tex" as flpmacro%}
{# -----------------------
 draw a resiter generic
-------------------#}
{%macro _draw_register_generic(flips_list= ["D","JK","RS"], outputs=["Q0","Q1", "Q2"],size=3)%}

{% if size != flips_list|length or size != outputs|length %}
 Warning: check parameters, The size '{{size}}' is different from flips list length '{{flips_list|length}}' or
 '{{outputs|length}}'
{%else%}
    {# draw a clock #}
    {{ flpmacro.draw_clock(name="Ck", label="Ck", xpos=0, ypos=0)}}
    {# draw a modules #}
    {% set ns = namespace(name="", id="", xpos=0, prev_name="", prev_type="", type="") %}
    {% set ypos = 2 %}
    {% for i in range(size) %}
        {% set ns.xpos = 2+3*i %}
        {% set ns.name = "flip"+(i|string) %}
        {% set ns.type = flips_list[i].upper() %}
        {% set ns.id = flips_list[i].upper() %}
        {{ flpmacro.place_flip(id=ns.id, name=ns.name, xpos=ns.xpos, ypos=ypos)}}

        {# link current with clock #}
        {{ flpmacro.link_clock (name_clock="Ck", name_target=ns.name, type_target=ns.type)}}

        {# link previous with current #}
        {% if ns.prev_name %}
            {{ flpmacro.link(name_source=ns.prev_name, name_target=ns.name, type_target=ns.type, method="direct")}}
        {% endif %}
        {% set ns.prev_name = ns.name %}
        {% set ns.prev_type = ns.type %}
    {%endfor%}

{%endif%}
{%endmacro%}


{# -----------------------
 draw a resiter one type flip
-------------------#}
{%macro draw_register(flip="D", register_type="",size=3)%}
{% set flips_list = [flip]*size %}
{% set ns = namespace(outputs = []) %}
{% for i in range(size) %}
    {% set _ = ns.outputs.append("Q" ~ i|string) %}
{% endfor %}
{{ _draw_register_generic(flips_list= flips_list, outputs=ns.outputs,size=size)}}

{%endmacro%}

{#----------------------------------------------------------
 Main_call
----------------------------------------------------------#}
\section{Register}

{{flpmacro.define_standard_flips()}}

{%if debug %}
 \textbf{Register}

\begin{circuitikz}
{{_draw_register_generic(flips_list= ["D","JK","RS"], outputs=["Q0","Q1", "Q2"],size=3)}}

\end{circuitikz}

 \textbf{Register  n bits}

\begin{circuitikz}
{{draw_register(flip="D", register_type="",size=6)}}

\end{circuitikz}

 \textbf{Register  n bits Jk}

\begin{circuitikz}
{{draw_register(flip="JK", register_type="",size=6)}}

\end{circuitikz}
{%endif%} % end of if