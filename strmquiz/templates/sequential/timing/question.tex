{#----------------------------------------------------------
 Macro: draw clock
----------------------------------------------------------#}
{%- macro draw_clock(data) -%}
{%set clock_signal ="$"~data.clock.name~"$ & [timing/c/"~data.synch_type~" arrows] C"~data.length~"{"~data.clock.period~"C}"%}
{{clock_signal}}
{%endmacro %}
{#----------------------------------------------------------
 Macro: draw given signals
  You must write it in one line, to avoid extra space that break the figure
----------------------------------------------------------#}
{%- macro draw_signals(signals) -%}
{% for name,sig in signals.items() %}{{ "$"~name~"$ &"}}{%for s in sig %}{{s|abs}}{{'H ' if s>0 else 'L '}}{% endfor%}{{'\\\\\n' if not loop.last }}{% endfor %}
{%endmacro %}

{#----------------------------------------------------------
 Macro: draw out signal
----------------------------------------------------------#}
{%- macro draw_out_signals(output_signals) -%}
{% if RENDER_MODE == "question" %}
{{draw_signals(output_signals.initial)}}
{% elif RENDER_MODE == "answer" %}
{{draw_signals(output_signals.final)}}
{% endif %}
{%endmacro %}
{#----------------------------------------------------------
 Macro: draw guide lines
----------------------------------------------------------#}
{%- macro draw_guide_lines(synch_type) -%}
{% if synch_type.lower() in ("rising", "dual") %}
\begin{scope}[red,semitransparent,densely dotted,thin]
\vertlines{2,4,...,\twidth}
\end{scope}
{% endif %}
{% if synch_type.lower() in ("falling", "dual") %}
\begin{scope}[gray,semitransparent,thin]
\vertlines{1,3,...,\twidth}
\end{scope}
{% endif %}
{%endmacro %}
{#----------------------------------------------------------
 Macro: draw  timing diagram
----------------------------------------------------------#}
{%- macro draw_timing_diagram(data) -%}
\paragraph{ Timing diagram  }\aRL{المخطط الزمني}

\begin{tikztimingtable}
%[timing/slope=.0, timing/draw grid]
[timing/slope=.0,  timing/wscale=1, scale=2.5, line width=1.25pt]
% horloge signal
{{ draw_clock(data) }}\\
{{ draw_signals(data.input_signals) }}\\
{{ draw_out_signals(data.output_signals)}}\\
\extracode
\begin{scope}[gray,semitransparent,densely dotted,thin]
\horlines{}
\vertlines{0}
\end{scope}
{{ draw_guide_lines(data.synch_type) }}
\end{tikztimingtable}
{%endmacro %}
{#----------------------------------------------------------
 Main_call
----------------------------------------------------------#}
Complete the following timing diagram : \hfill\aRL{أكمل المخطط الزمني الآتي}


{{draw_timing_diagram(data)}}



{%if debug %}
\paragraph{ Timing Latex version/old method} 1

{{data.tex_data_answer}}
{% endif %}

{% if RENDER_MODE == "answer" %}
{%if debug %}
\begin{verbatim}
Clock
{{draw_clock(data)}}
input signals
{{draw_signals(data.input_signals)}}
output signals initial
{{draw_signals(data.output_signals.initial)}}
output signals final
{{draw_signals(data.output_signals.final)}}
guidelines
{{ draw_guide_lines(data.synch_type) }}
***********
\end{verbatim}
\begin{verbatim}
   {{data|pprint}}
\end{verbatim}
{% endif %} %  end if debug
{% endif %} % end answer